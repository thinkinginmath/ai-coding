# 问题 1：实时通知系统

## 背景

你正在为一个 B2B SaaS 平台构建通知系统，该平台具有以下特点：
- 10,000 个活跃企业（租户）
- 500,000 总用户
- 通知类型包括：@提及、任务分配、评论、系统提醒
- 用户通过 Web 应用和移动应用访问

## 需求

1. 用户需要近乎实时地收到通知（< 3 秒）
2. 通知需要持久化存储，可以稍后查看（已读/未读状态）
3. 用户可以配置通知偏好设置（邮件、推送、应用内）
4. 系统峰值需要处理 100,000 条通知/小时

## 你的任务

### 第一部分：设计文档（占总分 40%）

创建 `DESIGN.zh-CN.md` 文件，包含：
1. 你选择的架构方案
2. 至少 2 个你考虑过的替代方案
3. 每个方案的权衡分析（优缺点）
4. 为什么在给定需求下选择你的方案
5. 如果规模扩大 100 倍，需要做哪些改变

### 第二部分：实现（占总分 40%）

实现核心通知服务：
- `POST /notifications` - 创建通知
- `GET /users/:userId/notifications` - 获取用户通知（支持分页）
- `PATCH /notifications/:id/read` - 标记通知为已读
- `GET /users/:userId/preferences` - 获取通知偏好设置
- `PUT /users/:userId/preferences` - 更新通知偏好设置
- 实时推送机制（方案自选）

### 第三部分：文档补充（占总分 20%）

在 `DESIGN.zh-CN.md` 中补充：
- 如何测试这个系统？
- 有哪些故障模式？如何处理？
- 生产环境需要监控哪些指标？

## 开始使用

```bash
npm install
npm run dev     # 启动开发服务器
npm test        # 运行测试
```

## 项目结构

```
src/
├── index.ts              # 应用入口
├── types.ts              # TypeScript 接口定义
├── routes/
│   └── notifications.ts  # API 路由处理（在此实现）
├── services/
│   ├── notification.service.ts  # 核心逻辑（在此实现）
│   └── realtime.service.ts      # 实时推送（在此实现）
├── storage/
│   └── memory.store.ts   # 内存存储（可替换）
└── mocks/
    ├── email.service.ts  # 模拟邮件服务
    └── push.service.ts   # 模拟推送服务
```

## 评分标准

| 等级 | 标准 |
|------|------|
| A | 深入的权衡分析，诚实地承认复杂性，实现与设计文档一致，识别出非显而易见的故障模式 |
| B | 合理的架构选择并有一定说明，实现可运行，基本的故障处理 |
| C | 实现可运行但推理薄弱，遗漏重要权衡，设计与实现不一致 |
| D | 实现可运行但没有有意义的架构讨论 |
